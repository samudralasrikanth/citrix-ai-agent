<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citrix AI Vision Agent ‚Äî Enterprise Dashboard</title>
    <meta name="description"
        content="Enterprise automation dashboard for Citrix AI Vision Agent ‚Äî record, run and monitor desktop automation playbooks.">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,300;0,14..32,400;0,14..32,500;0,14..32,600;0,14..32,700;1,14..32,400&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M12 2v3M12 19v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M2 12h3M19 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12">
                        </path>
                    </svg>
                </div>
                <div class="logo-text">
                    <span class="logo-title">Vision Agent</span>
                    <span class="logo-sub">Citrix Automation</span>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <div class="section-label">Test Suites</div>
            <ul class="nav-list" id="playbook-list">
                <li class="nav-placeholder">
                    <div class="placeholder-icon">üìÇ</div>
                    <span>No test suites yet</span>
                </li>
            </ul>
        </div>

        <div class="sidebar-footer">
            <button class="btn-new-test" id="btn-new-test">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Test Suite
            </button>
        </div>
    </aside>

    <!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="main-content">
        <!-- Header -->
        <header class="top-bar">
            <div class="breadcrumb">
                <span class="bc-root">Citrix Agent</span>
                <span class="bc-sep">/</span>
                <h1 id="current-playbook-name">Select a Test Suite</h1>
            </div>
            <div class="header-actions">
                <!-- Scan UI removed: now automatic during suite creation -->
                <div class="btn-divider"></div>
                <div class="execution-controls">
                    <button class="btn btn-secondary" id="btn-save" title="Save current file (Ctrl+S)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Save
                    </button>
                    <div class="btn-divider"></div>
                    <button class="btn btn-secondary" id="btn-dry-run" title="Dry Run ‚Äî no real actions">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Dry Run
                    </button>
                    <button class="btn btn-primary" id="btn-run">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Run Live
                    </button>
                    <button class="btn btn-danger hidden" id="btn-stop">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        </svg>
                        Stop
                    </button>
                </div>
            </div>
        </header>

        <!-- Step Progress Bar -->
        <div class="progress-bar-container" id="progress-container">
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill" style="width:0%"></div>
            </div>
            <span class="progress-label" id="progress-label">Idle</span>
        </div>

        <!-- Workspace -->
        <div class="workspace">
            <!-- Editor -->
            <div class="editor-panel">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <span id="editor-filename">playbook.yaml</span>
                        <span class="file-badge yaml-badge" id="file-badge">YAML</span>
                    </div>
                </div>
                <div class="editor-area" id="editor-area">
                    <div class="editor-welcome">
                        <div class="welcome-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5" opacity="0.3">
                                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                        </div>
                        <p class="welcome-text">Select a test suite from the sidebar to begin editing</p>
                        <button class="btn btn-secondary" id="btn-welcome-new" onclick="openModal()">+ Create New
                            Suite</button>
                    </div>
                </div>
            </div>

            <!-- Terminal / Log Panel -->
            <div class="log-panel">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <span>EXECUTION LOG</span>
                        <span class="status-pill idle" id="agent-status">IDLE</span>
                    </div>
                    <div class="panel-header-right">
                        <span class="step-counter" id="step-counter"></span>
                        <button class="btn btn-ghost" id="btn-clear-terminal">Clear</button>
                    </div>
                </div>
                <div class="log-body" id="terminal-output">
                    <div class="log-welcome">
                        <div class="log-logo">‚¨°</div>
                        <p>Citrix AI Vision Agent ready.</p>
                        <p class="log-hint">Select a test and click <strong>Run Live</strong> to begin.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Create Test Suite Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="modal-setup" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Create New Test Suite</h2>
                <button class="btn-icon" onclick="closeModal()" aria-label="Close modal">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <p class="modal-subtitle">Organize your automation into suites with isolated memory and reports.</p>

            <div class="form-grid">
                <div class="form-group">
                    <label for="new-region-name">Suite Name <span class="required">*</span></label>
                    <input type="text" id="new-region-name" placeholder="e.g. citrix_login_flow" autocomplete="off">
                </div>

                <div class="form-group">
                    <label>Platform Target <span class="required">*</span></label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="platform" value="citrix" checked>
                            <span>Citrix</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="platform" value="desktop">
                            <span>Desktop</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="platform" value="web">
                            <span>Web App</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Web Specific Config -->
            <div id="web-config-section" class="form-section hidden">
                <div class="section-divider"><span>Web Configuration</span></div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="web-url">Base URL</label>
                        <input type="text" id="web-url" placeholder="https://myapp.com">
                    </div>
                    <div class="form-group">
                        <label for="web-browser">Browser</label>
                        <select id="web-browser">
                            <option value="chrome">Google Chrome</option>
                            <option value="firefox">Mozilla Firefox</option>
                            <option value="edge">Microsoft Edge</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Capabilities</label>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="cap-db">
                        <span>Database Access</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="cap-api">
                        <span>API Access</span>
                    </label>
                </div>
            </div>

            <div class="form-group" id="window-selection-group">
                <label>Target Window <span class="required">*</span></label>
                <div class="window-list-wrapper">
                    <ul class="window-list" id="modal-window-list">
                        <li class="window-loading">
                            <div class="spinner"></div>
                            Detecting open windows‚Ä¶
                        </li>
                    </ul>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" id="btn-save-region">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Create Suite
                </button>
            </div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Record Session Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="modal-record" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-record-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-record-title" style="display:flex;align-items:center;gap:8px">
                    <span style="color:var(--danger);font-size:18px">‚è∫</span> Record New Test
                </h2>
                <button class="btn-icon" id="btn-close-record" aria-label="Close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <p class="modal-subtitle">Use our <strong>Semantic Recorder</strong> (Tosca-style). Each click captures the
                element's label and type ‚Äî not brittle coordinates. Recordings work even if the Citrix window moves.</p>

            <div class="form-group">
                <label for="record-test-name">Test Suite Name <span class="required">*</span></label>
                <input type="text" id="record-test-name" placeholder="e.g. citrix_login_flow" autocomplete="off">
                <p class="field-hint">Lowercase and underscores only. A new folder will be created in
                    <code>tests/</code>
                </p>
            </div>

            <!-- State: active recording -->
            <div id="record-info-box" class="record-info-box" style="display:none">
                <div class="record-pulse"></div>
                <div style="flex:1">
                    <strong style="color:var(--danger)">Recording Active</strong>
                    <p id="record-status-msg" style="margin:4px 0 0">
                        Hover over any Citrix element and click <strong>Capture Step</strong>, or press ENTER in the
                        terminal.
                    </p>
                    <p id="record-step-count" style="margin:6px 0 0;font-size:12px;color:var(--text-muted)">0 steps
                        recorded</p>
                </div>
            </div>

            <!-- State: finished -->
            <div id="record-done-box" class="record-done-box" style="display:none">
                <span style="font-size:22px">‚úÖ</span>
                <div>
                    <strong style="color:var(--accent)">Recording Saved</strong>
                    <p id="record-done-msg" style="margin:4px 0 0;font-size:13px;color:var(--text-secondary)">
                        Playbook saved. You can now run it from the sidebar.
                    </p>
                </div>
            </div>

            <!-- Actions row ‚Äî swaps based on state -->
            <div class="modal-actions" id="record-actions-idle">
                <button class="btn btn-secondary" id="btn-cancel-record">Cancel</button>
                <button class="btn btn-danger" id="btn-start-record">
                    <span class="rec-dot" style="width:8px;height:8px"></span>
                    Start Recording
                </button>
            </div>

            <div class="modal-actions" id="record-actions-active" style="display:none">
                <button class="btn btn-secondary" id="btn-stop-record">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                    Stop Recording
                </button>
                <button class="btn btn-primary" id="btn-capture-step">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" fill="currentColor"></circle>
                        <path
                            d="M12 2v3M12 19v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M2 12h3M19 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12">
                        </path>
                    </svg>
                    Capture Step
                </button>
            </div>

            <div class="modal-actions" id="record-actions-done" style="display:none">
                <button class="btn btn-primary" id="btn-record-done">Done</button>
            </div>
        </div>
    </div>


    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>